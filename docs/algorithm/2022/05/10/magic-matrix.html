<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Magic Matrix | Algorithm Blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Magic Matrix" />
<meta name="author" content="Liang Wang" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction In the field of recreational mathematics, the Magic Square is a popular puzzle. A magic square is a square grid filled with numbers such that every row, column, and diagonal have the same sum. The concept is not entirely new; it has been around for centuries. The puzzle was popularized by Albrecht Dürer, a German artist in the Renaissance period. The algorithm ‘magic’ generates a magic square of a given order." />
<meta property="og:description" content="Introduction In the field of recreational mathematics, the Magic Square is a popular puzzle. A magic square is a square grid filled with numbers such that every row, column, and diagonal have the same sum. The concept is not entirely new; it has been around for centuries. The puzzle was popularized by Albrecht Dürer, a German artist in the Renaissance period. The algorithm ‘magic’ generates a magic square of a given order." />
<link rel="canonical" href="https://blog.ocaml.xyz/algorithm/2022/05/10/magic-matrix.html" />
<meta property="og:url" content="https://blog.ocaml.xyz/algorithm/2022/05/10/magic-matrix.html" />
<meta property="og:site_name" content="Algorithm Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-10T07:18:03+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Magic Matrix" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Liang Wang"},"dateModified":"2022-05-10T07:18:03+03:00","datePublished":"2022-05-10T07:18:03+03:00","description":"Introduction In the field of recreational mathematics, the Magic Square is a popular puzzle. A magic square is a square grid filled with numbers such that every row, column, and diagonal have the same sum. The concept is not entirely new; it has been around for centuries. The puzzle was popularized by Albrecht Dürer, a German artist in the Renaissance period. The algorithm ‘magic’ generates a magic square of a given order.","headline":"Magic Matrix","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.ocaml.xyz/algorithm/2022/05/10/magic-matrix.html"},"url":"https://blog.ocaml.xyz/algorithm/2022/05/10/magic-matrix.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.ocaml.xyz/feed.xml" title="Algorithm Blog" /><script async src="https://www.googletagmanager.com/gtag/js?id=UA-123353217-1"></script>
<script>
  window['ga-disable-UA-123353217-1'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
  window.dataLayer = window.dataLayer || [];
  function gtag(){window.dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123353217-1');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1868946892712371" crossorigin="anonymous"></script></head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Algorithm Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Magic Matrix</h1>
    <p class="post-meta"><time class="dt-published" datetime="2022-05-10T07:18:03+03:00" itemprop="datePublished">
        May 10, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>
<p>In the field of recreational mathematics, the Magic Square is a popular puzzle. A magic square is a square grid filled with numbers such that every row, column, and diagonal have the same sum. The concept is not entirely new; it has been around for centuries. The puzzle was popularized by Albrecht Dürer, a German artist in the Renaissance period. The algorithm ‘magic’ generates a magic square of a given order.</p>

<h2 id="implementation">Implementation</h2>

<div class="language-ocaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">(* Magic Matrix *)</span>

<span class="k">let</span> <span class="n">magic</span> <span class="n">k</span> <span class="n">n</span> <span class="o">=</span>
  <span class="k">let</span> <span class="n">error</span> <span class="bp">()</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">Printf</span><span class="p">.</span><span class="n">sprintf</span> <span class="s2">"magic requires n &gt;= 3, whereas input n = %i"</span> <span class="n">n</span> <span class="k">in</span>
    <span class="nn">Owl_exception</span><span class="p">.</span><span class="nc">INVALID_ARGUMENT</span> <span class="n">s</span>
  <span class="k">in</span>
  <span class="nn">Owl_exception</span><span class="p">.</span><span class="n">verify</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="n">error</span><span class="p">;</span>
  <span class="k">let</span> <span class="n">a0</span> <span class="o">=</span> <span class="nn">Owl_const</span><span class="p">.</span><span class="n">zero</span> <span class="n">k</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">a1</span> <span class="o">=</span> <span class="nn">Owl_const</span><span class="p">.</span><span class="n">one</span> <span class="n">k</span> <span class="k">in</span>
  <span class="k">let</span> <span class="n">_magic_odd</span> <span class="n">n</span> <span class="n">a</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span> <span class="n">k</span> <span class="n">n</span> <span class="n">n</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">0</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">j</span> <span class="o">=</span> <span class="n">ref</span> <span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">ac</span> <span class="o">=</span> <span class="n">ref</span> <span class="p">(</span><span class="n">float_of_int</span> <span class="n">a</span> <span class="o">|&gt;</span> <span class="n">_float_typ_elt</span> <span class="n">k</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">|&gt;</span> <span class="n">float_of_int</span> <span class="o">|&gt;</span> <span class="n">_float_typ_elt</span> <span class="n">k</span> <span class="k">in</span>
    <span class="k">while</span> <span class="o">!</span><span class="n">ac</span> <span class="o">&lt;=</span> <span class="n">m</span> <span class="k">do</span>
      <span class="k">if</span> <span class="n">get</span> <span class="n">x</span> <span class="o">!</span><span class="n">i</span> <span class="o">!</span><span class="n">j</span> <span class="o">=</span> <span class="n">a0</span>
      <span class="k">then</span> <span class="p">(</span>
        <span class="n">set</span> <span class="n">x</span> <span class="o">!</span><span class="n">i</span> <span class="o">!</span><span class="n">j</span> <span class="o">!</span><span class="n">ac</span><span class="p">;</span>
        <span class="n">ac</span> <span class="o">:=</span> <span class="n">_add_elt</span> <span class="n">k</span> <span class="o">!</span><span class="n">ac</span> <span class="n">a1</span><span class="p">)</span>
      <span class="k">else</span> <span class="p">(</span>
        <span class="k">let</span> <span class="n">i'</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="ow">mod</span> <span class="n">n</span> <span class="k">in</span>
        <span class="k">let</span> <span class="n">j'</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">mod</span> <span class="n">n</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">get</span> <span class="n">x</span> <span class="n">i'</span> <span class="n">j'</span> <span class="o">=</span> <span class="n">a0</span>
        <span class="k">then</span> <span class="p">(</span>
          <span class="n">i</span> <span class="o">:=</span> <span class="n">i'</span><span class="p">;</span>
          <span class="n">j</span> <span class="o">:=</span> <span class="n">j'</span><span class="p">)</span>
        <span class="k">else</span> <span class="n">i</span> <span class="o">:=</span> <span class="p">(</span><span class="o">!</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">mod</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">done</span><span class="p">;</span>
    <span class="n">x</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="n">_magic_doubly_even</span> <span class="n">n</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span> <span class="n">k</span> <span class="n">n</span> <span class="n">n</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">_seq_inc</span> <span class="n">x</span> <span class="n">i0</span> <span class="n">j0</span> <span class="n">i1</span> <span class="n">j1</span> <span class="o">=</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i0</span> <span class="k">to</span> <span class="n">i1</span> <span class="k">do</span>
        <span class="k">let</span> <span class="n">ac</span> <span class="o">=</span> <span class="n">ref</span> <span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">j0</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">|&gt;</span> <span class="n">float_of_int</span> <span class="o">|&gt;</span> <span class="n">_float_typ_elt</span> <span class="n">k</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j0</span> <span class="k">to</span> <span class="n">j1</span> <span class="k">do</span>
          <span class="n">set</span> <span class="n">x</span> <span class="n">i</span> <span class="n">j</span> <span class="o">!</span><span class="n">ac</span><span class="p">;</span>
          <span class="n">ac</span> <span class="o">:=</span> <span class="n">_add_elt</span> <span class="n">k</span> <span class="o">!</span><span class="n">ac</span> <span class="n">a1</span>
        <span class="k">done</span>
      <span class="k">done</span>
    <span class="k">in</span>
    <span class="k">let</span> <span class="n">_seq_dec</span> <span class="n">x</span> <span class="n">i0</span> <span class="n">j0</span> <span class="n">i1</span> <span class="n">j1</span> <span class="o">=</span>
      <span class="k">let</span> <span class="n">ac</span> <span class="o">=</span> <span class="n">ref</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span> <span class="o">|&gt;</span> <span class="n">float_of_int</span> <span class="o">|&gt;</span> <span class="n">_float_typ_elt</span> <span class="n">k</span><span class="p">)</span> <span class="k">in</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i0</span> <span class="k">to</span> <span class="n">i1</span> <span class="k">do</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j0</span> <span class="k">to</span> <span class="n">j1</span> <span class="k">do</span>
          <span class="k">if</span> <span class="n">get</span> <span class="n">x</span> <span class="n">i</span> <span class="n">j</span> <span class="o">=</span> <span class="n">a0</span> <span class="k">then</span> <span class="n">set</span> <span class="n">x</span> <span class="n">i</span> <span class="n">j</span> <span class="o">!</span><span class="n">ac</span><span class="p">;</span>
          <span class="n">ac</span> <span class="o">:=</span> <span class="n">_sub_elt</span> <span class="n">k</span> <span class="o">!</span><span class="n">ac</span> <span class="n">a1</span>
        <span class="k">done</span>
      <span class="k">done</span>
    <span class="k">in</span>
    <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">4</span> <span class="k">in</span>
    <span class="n">_seq_inc</span> <span class="n">x</span> <span class="mi">0</span> <span class="mi">0</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">_seq_inc</span> <span class="n">x</span> <span class="mi">0</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">_seq_inc</span> <span class="n">x</span> <span class="n">m</span> <span class="n">m</span> <span class="p">((</span><span class="mi">3</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">((</span><span class="mi">3</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">_seq_inc</span> <span class="n">x</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="mi">0</span> <span class="p">((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">_seq_inc</span> <span class="n">x</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="p">((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">((</span><span class="mi">4</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">_seq_dec</span> <span class="n">x</span> <span class="mi">0</span> <span class="mi">0</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">x</span>
  <span class="k">in</span>
  <span class="k">let</span> <span class="n">_magic_singly_even</span> <span class="n">n</span> <span class="o">=</span>
    <span class="k">let</span> <span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">m</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">xa</span> <span class="o">=</span> <span class="n">_magic_odd</span> <span class="n">m</span> <span class="mi">1</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">xb</span> <span class="o">=</span> <span class="n">_magic_odd</span> <span class="n">m</span> <span class="p">(</span><span class="n">m2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">xc</span> <span class="o">=</span> <span class="n">_magic_odd</span> <span class="n">m</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">xd</span> <span class="o">=</span> <span class="n">_magic_odd</span> <span class="n">m</span> <span class="p">((</span><span class="mi">3</span> <span class="o">*</span> <span class="n">m2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">m3</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">in</span>
    <span class="k">let</span> <span class="n">xa'</span> <span class="o">=</span>
      <span class="n">concat_horizontal</span>
        <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m3</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xd</span><span class="p">)</span>
        <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="n">m3</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xa</span><span class="p">)</span>
    <span class="k">in</span>
    <span class="k">let</span> <span class="n">xd'</span> <span class="o">=</span>
      <span class="n">concat_horizontal</span>
        <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m3</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xa</span><span class="p">)</span>
        <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="n">m3</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xd</span><span class="p">)</span>
    <span class="k">in</span>
    <span class="k">let</span> <span class="n">xb'</span> <span class="o">=</span>
      <span class="k">if</span> <span class="n">m3</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">then</span> <span class="n">xb</span>
      <span class="k">else</span>
        <span class="n">concat_horizontal</span>
          <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m</span> <span class="o">-</span> <span class="n">m3</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xb</span><span class="p">)</span>
          <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">m3</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xc</span><span class="p">)</span>
    <span class="k">in</span>
    <span class="k">let</span> <span class="n">xc'</span> <span class="o">=</span>
      <span class="k">if</span> <span class="n">m3</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">then</span> <span class="n">xc</span>
      <span class="k">else</span>
        <span class="n">concat_horizontal</span>
          <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m</span> <span class="o">-</span> <span class="n">m3</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xc</span><span class="p">)</span>
          <span class="p">(</span><span class="n">get_slice</span> <span class="p">[</span> <span class="bp">[]</span><span class="p">;</span> <span class="p">[</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">m3</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span> <span class="p">]</span> <span class="p">]</span> <span class="n">xb</span><span class="p">)</span>
    <span class="k">in</span>
    <span class="n">set</span> <span class="n">xa'</span> <span class="n">m3</span> <span class="mi">0</span> <span class="p">(</span><span class="n">get</span> <span class="n">xa</span> <span class="n">m3</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">set</span> <span class="n">xa'</span> <span class="n">m3</span> <span class="n">m3</span> <span class="p">(</span><span class="n">get</span> <span class="n">xd</span> <span class="n">m3</span> <span class="n">m3</span><span class="p">);</span>
    <span class="n">set</span> <span class="n">xd'</span> <span class="n">m3</span> <span class="mi">0</span> <span class="p">(</span><span class="n">get</span> <span class="n">xd</span> <span class="n">m3</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">set</span> <span class="n">xd'</span> <span class="n">m3</span> <span class="n">m3</span> <span class="p">(</span><span class="n">get</span> <span class="n">xa</span> <span class="n">m3</span> <span class="n">m3</span><span class="p">);</span>
    <span class="n">concat_horizontal</span> <span class="p">(</span><span class="n">concat_vertical</span> <span class="n">xa'</span> <span class="n">xd'</span><span class="p">)</span> <span class="p">(</span><span class="n">concat_vertical</span> <span class="n">xc'</span> <span class="n">xb'</span><span class="p">)</span>
  <span class="k">in</span>
  <span class="c">(* n is odd *)</span>
  <span class="k">if</span> <span class="nn">Owl_maths</span><span class="p">.</span><span class="n">is_odd</span> <span class="n">n</span>
  <span class="k">then</span> <span class="n">_magic_odd</span> <span class="n">n</span> <span class="mi">1</span> <span class="c">(* n is doubly even *)</span>
  <span class="k">else</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">mod</span> <span class="mi">4</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">then</span> <span class="n">_magic_doubly_even</span> <span class="n">n</span> <span class="c">(* n is singly even *)</span>
  <span class="k">else</span> <span class="n">_magic_singly_even</span> <span class="n">n</span>

</code></pre></div></div>

<p>The implementation has a function named “magic”, which generates a magic square of a given order and it has two parameters. The first is the precision level, k, which is used to define the data type of the entries in the magic square. The second parameter is the order of the magic square.</p>

<h2 id="step-by-step-explanation">Step-by-step Explanation</h2>

<p>This algorithm follows four steps to generate a magic square of any order (n).</p>

<h3 id="1-verification-of-validity">1. Verification of Validity</h3>
<p>The function first checks the validity of input parameter n. The minimum valid value of n is three.</p>

<h3 id="2-determination-of-magic-square-type">2. Determination of Magic Square Type</h3>
<p>The algorithm proceeds to determine the type of magic square required. There are three types of magic squares:</p>
<ul>
  <li>Odd-order: This type of magic square occurs when n is odd.</li>
  <li>Singly Even-order: This type of magic square occurs when n is even, but not divisible by 4.</li>
  <li>Doubly Even-order: This type of magic square occurs when n is divisible by 4.</li>
</ul>

<h3 id="3-determination-of-entries">3. Determination of Entries</h3>
<p>The third step involves determining the entries of the magic square by computing the columns, rows, and diagonals. The magic square matrix is called x. The implementation uses the following three functions to compute the magic square.</p>
<h4 id="i-_magic_odd">i. _magic_odd</h4>
<p>This function is called if n is an odd integer. This function computes an odd-ordered magic square. The algorithm begins from the top-middle cell of the magic square matrix. Next, the algorithm calculates the next cell using the rules specified for generating odd-order magic squares. The calculation involves moving one row up and one column right. If the calculated cell is not already filled, the next element in the sequence is filled in. If the cell is already occupied, the algorithm then moves one row down and repeats the process.</p>
<h4 id="ii-_magic_singly_even">ii. _magic_singly_even</h4>
<p>This function is called if n is an even integer and has a remainder of 2 when divided by 4. This function generates a singly even-ordered magic square. A singly even-ordered magic square of order n is built from four magic squares of order n/2. The sub-squares are arranged in a rotated position, and the diagonals of the sub-squares are filled in the larger square to obtain the required magic square.</p>
<h4 id="iii-_magic_doubly_even">iii. _magic_doubly_even</h4>
<p>This function is called if n is an even integer that is divisible by 4.  This function generates a doubly even-ordered magic square. The sub-squares of a doubly even-ordered magic square are filled using the formula X[n-j+1][n-i+1] = k2 - X[i][j] + 1.</p>

<h3 id="4-returning-the-magic-square">4. Returning the Magic Square</h3>
<p>The final step involves returning the magic square created in step 3.</p>

<h2 id="complexity-analysis">Complexity Analysis</h2>
<p>The time complexity of this algorithm is O(n^2). The space complexity of the implementation is the memory used to store the nxn magic square matrix, which is O(n^2). However, the precision level k used can also affect the space complexity.</p>

  </div><a class="u-url" href="/algorithm/2022/05/10/magic-matrix.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://blog.ocaml.xyz/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Liang Wang</li>
          <li><a class="u-email" href="mailto:liang@ocaml.xyz">liang@ocaml.xyz</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>Explore the elegance of classic and numerical algorithms</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
